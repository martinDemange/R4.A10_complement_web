<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>td01</title>
    <link rel='stylesheet' href='td01_style.css'>
</head>
<body>
    <div role="tablist" id="tablist" aria-live="polite" class="manual">
        <button id="tab-1" type="button" role="tab" aria-selected="true" aria-controls="panel-1">Température</button>
        <button id="tab-2" type="button" role="tab" aria-selected="false" aria-controls="panel-2">Historique</button>
    </div>
    <div id="panel-1" role="tabpanel" aria-labelledby="tab-1" >
        <h1>Temperature</h1>
        <div title="block01" id="block01" aria-live="polite" role="alert"></div>
    </div>
    <div id="panel-2" role="tabpanel" aria-labelledby="tab-2">
        <h1>Historique des températures</h1>
        <div title="block02" id="block02"></div>
        <script>

            var O_block02 = document.getElementById('block02');
            var O_block01 = document.getElementById('block01');

            class TabsManual {
                constructor(groupNode) {
                    this.tablistNode = groupNode;

                    this.tabs = [];

                    this.firstTab = null;
                    this.lastTab = null;

                    this.tabs = Array.from(this.tablistNode.querySelectorAll('[role=tab]'));
                    this.tabpanels = [];

                    for (var i = 0; i < this.tabs.length; i += 1) {
                        var tab = this.tabs[i];
                        var tabpanel = document.getElementById(tab.getAttribute('aria-controls'));

                        tab.tabIndex = -1;
                        tab.setAttribute('aria-selected', 'false');
                        this.tabpanels.push(tabpanel);

                        //tab.addEventListener('keydown', this.onKeydown.bind(this));
                        tab.addEventListener('click', this.onClick.bind(this));

                        if (!this.firstTab) {
                            this.firstTab = tab;
                        }
                        this.lastTab = tab;
                    }

                    this.setSelectedTab(this.firstTab);
                }

                setSelectedTab(currentTab) {
                    for (var i = 0; i < this.tabs.length; i += 1) {
                        var tab = this.tabs[i];
                        if (currentTab === tab) {
                            tab.setAttribute('aria-selected', 'true');
                            tab.removeAttribute('tabindex');
                            this.tabpanels[i].classList.remove('is-hidden');
                        } else {
                            tab.setAttribute('aria-selected', 'false');
                            tab.tabIndex = -1;
                            this.tabpanels[i].classList.add('is-hidden');
                        }
                    }
                }

                moveFocusToTab(currentTab) {
                    currentTab.focus();
                }

                /* EVENT HANDLERS */

                // Since this example uses buttons for the tabs, the click onr also is activated
                // with the space and enter keys
                onClick(event) {
                    this.setSelectedTab(event.currentTarget);
                }
            }

            class Temperature {
                constructor(writeNode, writeHistoryNode) {
                    this.O_writeNode = writeNode;
                    this.O_writeHistoryNode = writeHistoryNode;
                    this.A_arrayBlock01 = this.genArrayRandInt(40);
                    console.log(this.A_arrayBlock01);
                    this.S_stringCold = '\n : ' + "Brrrrrrr, un peu froid ce matin, mets ta cagoule !";
                    this.S_stringHot = '\n : ' + "Caliente ! Vamos a la playa, ho hoho hoho !!";
                    this.writeTemperature();
                }
                genArrayRandInt(I_max){
                    I_max = I_max + 10;
                    var A_arrayRandInt = [];
                    for (let I_index=0; I_index < 20;I_index++){
                        A_arrayRandInt.push(Math.floor(Math.random() * I_max)-10);
                    }
                    return A_arrayRandInt;
                }
                writeTemperature(){
                 let I_indexArrayBlock01 = 0;
                    setInterval(() => {
                        //O_writeBlock01.append(A_arrayBlock01[I_index]+' ');
                        let I_index = I_indexArrayBlock01;
                        this.O_writeNode.textContent = this.A_arrayBlock01[I_index] + '°C ';
                        O_block02.append(this.A_arrayBlock01[I_index] + '°C, ');

                        if (this.A_arrayBlock01[I_index] <= 0 && this.A_arrayBlock01[I_index] >= -10){
                            this.O_writeNode.setAttribute("class", "blue");
                            this.O_writeNode.append(this.S_stringCold);
                        }
                        if(this.A_arrayBlock01[I_index] <= 20 && this.A_arrayBlock01[I_index] > 0){
                            this.O_writeNode.setAttribute("class", "green");
                        }
                        if(this.A_arrayBlock01[I_index] <= 30 && this.A_arrayBlock01[I_index] > 20){
                            this.O_writeNode.setAttribute("class", "orange");
                            this.O_writeNode.append(this.S_stringHot);
                        }
                        if(this.A_arrayBlock01[I_index] <= 40 && this.A_arrayBlock01[I_index] > 30){
                            this.O_writeNode.setAttribute("class", "red");
                            this.O_writeNode.append(this.S_stringHot);
                        }

                        I_indexArrayBlock01++;
                        if (I_index === this.A_arrayBlock01.length-1) {I_indexArrayBlock01=0}
                    },250);
                }
            }

            // Initialize tablists and the class TabsManual
            window.addEventListener('load', function () {
                var tablists = document.querySelectorAll('[role=tablist].manual');
                for (var i = 0; i < tablists.length; i++) {
                    new TabsManual(tablists[i]);
                }
            });

            new Temperature(O_block01, O_block02);

        </script>
    </div>
</body>
</html>